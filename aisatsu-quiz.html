<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Aisatsu N5</title>
    <style>
        :root { --primary: #845ef7; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .quiz-container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; margin-top: 20px; }
        .q-word { font-size: 28px; font-weight: bold; color: #2f3542; margin: 20px 0; min-height: 80px; display: flex; align-items: center; justify-content: center; line-height: 1.4; }
        .options-grid { display: grid; gap: 10px; }
        .option-btn { padding: 15px; border: 2px solid #dfe4ea; border-radius: 12px; background: white; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .correct { background: #2ed573 !important; color: white; border-color: #2ed573; }
        .wrong { background: #ff4757 !important; color: white; border-color: #ff4757; }
        .progress { font-size: 14px; color: #a4b0be; margin-bottom: 10px; }
        .btn-start { background: var(--primary); color: white; padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; font-size: 18px; }
        #result-box { display: none; }
    </style>
</head>
<body>

<div class="quiz-container">
    <div id="setup-box">
        <h2 style="color: var(--primary);">Kuis Aisatsu (Salam)</h2>
        <p>Uji hafalan 40 salam bahasa Jepang Anda.</p>
        <button class="btn-start" onclick="startQuiz()">Mulai Kuis</button>
    </div>

    <div id="quiz-box" style="display:none;">
        <div class="progress" id="progressText">Soal 0/40</div>
        <div class="q-word" id="qText"></div>
        <div class="options-grid" id="options"></div>
    </div>

    <div id="result-box">
        <h2>Latihan Selesai! üëè</h2>
        <p style="font-size: 24px;" id="finalScore"></p>
        <button class="btn-start" onclick="location.reload()">Ulangi Kuis</button>
        <br><br>
        <a href="index.html" style="text-decoration:none; color: #747d8c;">Kembali ke Menu Utama</a>
    </div>
</div>

<script>
    const CLOUD_URL = 'https://gist.githubusercontent.com/TaddZZ-N/d35086624e71d0228e3b9280dcc9d0ea/raw/gistfile1.txt';
    let aisatsuData = [];
    let currentIndex = 0;
    let score = 0;

    async function startQuiz() {
        try {
            const response = await fetch(CLOUD_URL + '?t=' + new Date().getTime());
            const data = await response.json();
            
            // Ambil hanya kategori aisatsu dan acak urutannya
            aisatsuData = data.filter(item => item.cat === 'aisatsu').sort(() => Math.random() - 0.5);

            if(aisatsuData.length === 0) {
                alert("Data Aisatsu belum ada di Gist Anda.");
                return;
            }

            document.getElementById('setup-box').style.display = 'none';
            document.getElementById('quiz-box').style.display = 'block';
            showQuestion();
        } catch (e) {
            alert("Gagal memuat data. Periksa koneksi internet.");
        }
    }

    function showQuestion() {
        if (currentIndex >= aisatsuData.length) {
            showResult();
            return;
        }

        const item = aisatsuData[currentIndex];
        document.getElementById('progressText').innerText = `Soal ${currentIndex + 1} / ${aisatsuData.length}`;
        // Tampilkan Kanji atau Kana
        document.getElementById('qText').innerText = item.kanji;

        // Buat pilihan jawaban (1 benar, 3 salah)
        let choices = [item.meaning];
        let otherMeanings = aisatsuData.filter(a => a.meaning !== item.meaning).map(a => a.meaning);
        
        while (choices.length < 4 && otherMeanings.length > 0) {
            let randIdx = Math.floor(Math.random() * otherMeanings.length);
            let randMeaning = otherMeanings.splice(randIdx, 1)[0];
            if (!choices.includes(randMeaning)) choices.push(randMeaning);
        }
        choices.sort(() => Math.random() - 0.5);

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = '';
        choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = choice;
            btn.onclick = () => checkAnswer(choice, item.meaning, btn);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selected, correct, btn) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        if (selected === correct) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            allBtns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });
        }

        setTimeout(() => {
            currentIndex++;
            showQuestion();
        }, 1500);
    }

    function showResult() {
        document.getElementById('quiz-box').style.display = 'none';
        document.getElementById('result-box').style.display = 'block';
        document.getElementById('finalScore').innerText = `Skor Anda: ${score} / ${aisatsuData.length}`;
    }
</script>
</body>
</html>
